"milab-human-bcr-multiplex-cdr3":
  inheritFrom: _universal
  pipeline:
    - align
    - refineTagsAndSort
    - assemble
    - exportClones
  mixins:
    - type: SetSpecies
      species: hsa
    - type: LeftAlignmentBoundaryNoPoint
      floating: false
    - type: RightAlignmentBoundaryNoPoint
      floating: false
      geneType: C
    - type: SetClonotypeAssemblingFeatures
      features: [ "CDR3" ]
    - type: AddExportClonesField
      insertIndex: 2
      field: -uniqueTagCount
      args: [ "UMI" ]
  align:
    inheritFrom: align_kaligner2_4.0
    overrides:
      tagPattern: ^N{0:2}tggtatcaacgcagagt(UMI:N{14})N{20}(R1:*) \ ^N{22}(R2:*)
  refineTagsAndSort:
    inheritFrom: refineTagsAndSort_universal
    overrides:
      parameters:
        postFilter:
          type: "filter_groups"
          groupingKeys:
            - "UMI"
          predicates:
            - metrics:
                - type: "group_metric_sum_weight"
                  reportHist:
                    log: true
                    binNumber: 0 # don't limit number of bins, use only minBinWidth
                    minBinWidth: 0.2 # in respect to log10 of the value
              operator:
                type: "group_operator_otsu1"
                logX: true
  assemble:
    inheritFrom: assemble_universal
    overrides:
      cloneAssemblerParameters:
        separateByJ: true
        separateByV: true
        separateByC: true

"milab-human-bcr-multiplex-full-length":
  inheritFrom: _universal
  pipeline:
    - align
    - refineTagsAndSort
    - assemble
    - exportClones
  mixins:
    - type: SetSpecies
      species: hsa
    - type: LeftAlignmentBoundaryNoPoint
      floating: false
    - type: RightAlignmentBoundaryNoPoint
      floating: false
      geneType: C
    - type: SetClonotypeAssemblingFeatures
      features: [ "{CDR1Begin:FR4End}" ]
    - type: AddExportClonesField
      insertIndex: 2
      field: -uniqueTagCount
      args: [ "UMI" ]
  align:
    inheritFrom: align_kaligner2_4.0
    overrides:
      tagPattern: ^N{0:2}tggtatcaacgcagagt(UMI:N{14})N{20}(R1:*) \ ^N{22}(R2:*)
  refineTagsAndSort:
    inheritFrom: refineTagsAndSort_universal
    overrides:
      parameters:
        postFilter:
          type: "filter_groups"
          groupingKeys:
            - "UMI"
          predicates:
            - metrics:
                - type: "group_metric_sum_weight"
                  reportHist:
                    log: true
                    binNumber: 0 # don't limit number of bins, use only minBinWidth
                    minBinWidth: 0.2 # in respect to log10 of the value
              operator:
                type: "group_operator_otsu1"
                logX: true
  assemble:
    inheritFrom: assemble_universal
    overrides:
      cloneAssemblerParameters:
        separateByC: true

"milab-human-tcr-rna-race-cdr3":
  inheritFrom: _universal
  pipeline:
    - align
    - refineTagsAndSort
    - assemble
    - exportClones
  mixins:
    - type: SetSpecies
      species: hsa
    - type: LeftAlignmentBoundaryNoPoint
      floating: false
    - type: RightAlignmentBoundaryNoPoint
      floating: true
      geneType: C
    - type: SetClonotypeAssemblingFeatures
      features: [ "CDR3" ]
    - type: AddExportClonesField
      insertIndex: 2
      field: -uniqueTagCount
      args: [ "UMI" ]
  align:
    inheritFrom: align_default_4.0
    overrides:
      tagPattern: ^(R1:*) \ ^tggtatcaacgcagagt(UMI:N{14})(R2:*)
  refineTagsAndSort:
    inheritFrom: refineTagsAndSort_universal
    overrides:
      parameters:
        postFilter:
          type: "filter_groups"
          groupingKeys:
            - "UMI"
          predicates:
            - metrics:
                - type: "group_metric_sum_weight"
                  reportHist:
                    log: true
                    binNumber: 0 # don't limit number of bins, use only minBinWidth
                    minBinWidth: 0.2 # in respect to log10 of the value
              operator:
                type: "group_operator_otsu1"
                logX: true
  assemble:
    inheritFrom: assemble_universal
    overrides:
      cloneAssemblerParameters:
        separateByJ: true
        separateByV: true

"milab-human-tcr-rna-race-full-length":
  inheritFrom: _universal
  pipeline:
    - align
    - refineTagsAndSort
    - assemble
    - exportClones
  mixins:
    - type: SetSpecies
      species: hsa
    - type: LeftAlignmentBoundaryNoPoint
      floating: false
    - type: RightAlignmentBoundaryNoPoint
      floating: true
      geneType: C
    - type: SetClonotypeAssemblingFeatures
      features: [ "VDJRegion" ]
    - type: AddExportClonesField
      insertIndex: 2
      field: -uniqueTagCount
      args: [ "UMI" ]
  align:
    inheritFrom: align_default_4.0
    overrides:
      tagPattern: ^(R1:*) \ ^tggtatcaacgcagagt(UMI:N{14})(R2:*)
  refineTagsAndSort:
    inheritFrom: refineTagsAndSort_universal
    overrides:
      parameters:
        postFilter:
          type: "filter_groups"
          groupingKeys:
            - "UMI"
          predicates:
            - metrics:
                - type: "group_metric_sum_weight"
                  reportHist:
                    log: true
                    binNumber: 0 # don't limit number of bins, use only minBinWidth
                    minBinWidth: 0.2 # in respect to log10 of the value
              operator:
                type: "group_operator_otsu1"
                logX: true

"milab-human-tcr-rna-multiplex-cdr3":
  inheritFrom: _universal
  pipeline:
    - align
    - refineTagsAndSort
    - assemble
    - exportClones
  mixins:
    - type: SetSpecies
      species: hsa
    - type: LeftAlignmentBoundaryNoPoint
      floating: false
    - type: RightAlignmentBoundaryNoPoint
      floating: false
      geneType: C
    - type: SetClonotypeAssemblingFeatures
      features: [ "CDR3" ]
    - type: AddExportClonesField
      insertIndex: 2
      field: -uniqueTagCount
      args: [ "UMI" ]
  align:
    inheritFrom: align_default_4.0
    overrides:
      tagPattern: ^N{0:2}tggtatcaacgcagagt(UMI:N{14})N{21}(R1:*) \ ^N{20}(R2:*)
  refineTagsAndSort:
    inheritFrom: refineTagsAndSort_universal
    overrides:
      parameters:
        postFilter:
          type: "filter_groups"
          groupingKeys:
            - "UMI"
          predicates:
            - metrics:
                - type: "group_metric_sum_weight"
                  reportHist:
                    log: true
                    binNumber: 0 # don't limit number of bins, use only minBinWidth
                    minBinWidth: 0.2 # in respect to log10 of the value
              operator:
                type: "group_operator_otsu1"
                logX: true
  assemble:
    inheritFrom: assemble_universal
    overrides:
      cloneAssemblerParameters:
        separateByJ: true
        separateByV: true

"milab-human-tcr-dna-multiplex-cdr3":
  inheritFrom: default_4.0
  pipeline:
    - align
    - assemble
    - exportClones
  mixins:
    - type: SetSpecies
      species: hsa
    - type: MaterialTypeDNA
    - type: SetClonotypeAssemblingFeatures
      features: [ "CDR3" ]
    - type: LeftAlignmentBoundaryNoPoint
      floating: true
    - type: RightAlignmentBoundaryNoPoint
      floating: false
      geneType: J
  assemble:
    inheritFrom: assemble_universal
    overrides:
      cloneAssemblerParameters:
        separateByJ: true
        separateByV: true
